<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormWorks Editor to Mermaid Diagram Converter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #333;
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .brand-logo {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            color: white;
        }
        .brand-logo i {
            margin-right: 10px;
        }
        .container {
            margin-top: 20px;
            flex: 1;
        }
        .tabs .tab a {
            color: #00796b;
        }
        .tabs .tab a:hover, .tabs .tab a.active {
            color: #004d40;
        }
        .tabs .indicator {
            background-color: #004d40;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .center-align {
            text-align: center;
        }
        .diagram-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .diagram-controls .btn {
            min-width: 120px;
        }
        .diagram {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            height: 600px;
        }
        .mermaid {
            background-color: white;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
            resize: both;
            overflow: auto;
            width: 100%;
            height: 100%;
        }
        footer {
            background-color: #333;
            color: #fff;
            padding: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
        }
        .footer-text {
            text-align: center;
        }
        .dark-mode-switch {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        .dark-mode-switch label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .dark-mode-switch .lever {
            width: 40px;
            height: 20px;
            background-color: #9e9e9e;
            border-radius: 20px;
            position: relative;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        .dark-mode-switch input[type="checkbox"]:checked + .lever {
            background-color: #004d40;
        }
        .dark-mode-switch .lever::before {
            content: '';
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 0;
            transition: left 0.3s;
        }
        .dark-mode-switch input[type="checkbox"]:checked + .lever::before {
            left: 20px;
        }
        .dark-mode-body {
            background-color: #121212;
            color: #fff;
        }
        .dark-mode-body header {
            background-color: #1a237e;
        }
        .dark-mode-body .mermaid {
            background-color: #424242;
            color: #fff;
        }
        .dark-mode-body footer {
            background-color: #1a237e;
        }
        .dark-mode-body .btn {
            background-color: #424242;
            color: #fff;
        }
        .dark-mode-body .tooltipped {
            background-color: #424242;
        }
        .dark-mode-body .footer-text {
            color: #80cbc4;
        }
        .editor-container {
            display: flex;
            flex-wrap: wrap;
        }
        .editor-container > div {
            flex: 1;
            padding: 10px;
        }
        .editor-section {
            display: flex;
            flex-direction: column;
        }
        .editor-section textarea {
            flex: 1;
        }
        .diagram-section {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            min-height: 300px;
        }
        .faq-section, .contact-section {
            padding: 20px;
        }
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .faq-item {
            margin-bottom: 10px;
        }
        .faq-item strong {
            display: block;
            font-weight: 600;
        }
        .contact-section form .input-field {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="nav-wrapper">
            <div class="container">
                <a href="#" class="brand-logo">
                    <i class="material-icons">bubble_chart</i>
                    FormWorks Editor to Mermaid Diagram Converter
                </a>
            </div>
        </nav>
    </header>
    <main class="container">
        <div class="row">
            <div class="col s12">
                <ul class="tabs">
                    <li class="tab col s4"><a href="#diagramTab" class="active">Diagram Viewer</a></li>
                    <li class="tab col s4"><a href="#editorTab">Mermaid Code Editor</a></li>
                    <li class="tab col s4"><a href="#faqTab">FAQ</a></li>
                </ul>
            </div>
            <div id="diagramTab" class="col s12 tab-content active">
                <h1 class="center-align">Welcome to Mermaid Diagram Viewer</h1>
                <p class="center-align">Create, view, and export your Mermaid diagrams effortlessly.</p>
                <div class="diagram-controls">
                    <button id="zoomIn" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Zoom In">ZOOM IN</button>
                    <button id="zoomOut" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Zoom Out">ZOOM OUT</button>
                    <button id="resetZoom" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Reset Zoom">RESET ZOOM</button>
                    <button id="fitToScreen" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Fit to Screen">FIT TO SCREEN</button>
                    <button id="exportSvg" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Export as SVG">EXPORT SVG</button>
                    <button id="exportPng" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Export as PNG">EXPORT PNG</button>
                    <button id="exportPdf" class="btn waves-effect waves-light tooltipped" data-position="bottom" data-tooltip="Export as PDF">EXPORT PDF</button>
                </div>
                <div class="diagram">
                    <div id="diagramContainer"></div>
                </div>
                <div id="loadingSpinner" class="preloader-wrapper active">
                    <div class="spinner-layer spinner-blue-only">
                        <div class="circle-clipper left">
                            <div class="circle"></div>
                        </div>
                        <div class="gap-patch">
                            <div class="circle"></div>
                        </div>
                        <div class="circle-clipper right">
                            <div class="circle"></div>
                        </div>
                    </div>
                </div>
                <div class="dark-mode-switch center-align">
                    <label for="darkModeCheckbox">
                        <span>Dark Mode</span>
                        <input type="checkbox" id="darkModeCheckbox">
                        <span class="lever"></span>
                    </label>
                </div>
            </div>
            <div id="editorTab" class="col s12 tab-content">
                <div class="editor-container">
                    <div class="col s12 m6 editor-section">
                        <h5>Code</h5>
                        <textarea id="mermaidCodeEditor" class="materialize-textarea" placeholder="Enter Mermaid code here..."></textarea>
                        <button id="renderDiagram" class="btn waves-effect waves-light">RENDER DIAGRAM</button>
                        <div class="file-field input-field">
                            <div class="btn">
                                <span>Import MMD</span>
                                <input type="file" id="importMmd" accept=".mmd">
                            </div>
                            <div class="file-path-wrapper">
                                <input class="file-path validate" type="text">
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m6 editor-section">
                        <h5>Mermaid Configuration</h5>
                        <textarea id="mermaidConfigEditor" class="materialize-textarea" placeholder="Enter Mermaid configuration here..."></textarea>
                    </div>
                </div>
            </div>
            <div id="faqTab" class="col s12 tab-content">
                <section class="faq-section">
                    <h2 class="section-title">Frequently Asked Questions</h2>
                    <div class="faq-item">
                        <strong>What is Mermaid Diagram Viewer?</strong>
                        <p>A tool to create, view, and export Mermaid diagrams.</p>
                    </div>
                    <div class="faq-item">
                        <strong>How can I export diagrams?</strong>
                        <p>You can export diagrams in SVG, PNG, or PDF formats.</p>
                    </div>
                    <div class="faq-item">
                        <strong>Is there a dark mode available?</strong>
                        <p>Yes, you can switch between light and dark modes.</p>
                    </div>
                    <div class="faq-item">
                        <strong>Can I zoom in on diagrams?</strong>
                        <p>Yes, you can zoom in and out for a detailed view.</p>
                    </div>
                    <div class="faq-item">
                        <strong>How do I fit the diagram to my screen?</strong>
                        <p>Use the 'Fit to Screen' button to perfectly fit the diagram to your screen size.</p>
                    </div>
                    <div class="faq-item">
                        <strong>Where can I find help?</strong>
                        <p>Click on the help button in the top-right corner for instructions.</p>
                    </div>
                </section>
            </div>
        </div>
        <section class="contact-section">
            <h2 class="section-title">Get in Touch</h2>
            <form>
                <div class="input-field">
                    <input type="text" id="name" name="name" class="validate">
                    <label for="name">Name</label>
                </div>
                <div class="input-field">
                    <input type="email" id="email" name="email" class="validate">
                    <label for="email">Email</label>
                </div>
                <div class="input-field">
                    <textarea id="message" name="message" class="materialize-textarea"></textarea>
                    <label for="message">Message</label>
                </div>
                <button type="submit" class="btn waves-effect waves-light">Send Message</button>
            </form>
        </section>
    </main>
    <footer>
        <div class="container footer-text">
            <p>Developed by the FormWorks Development Team</p>
            <p>Special thanks to the Intake Greyhounds Agile Team</p>
        </div>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom/dist/svg-pan-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.32.1/min/vs/loader.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            mermaid.initialize({ startOnLoad: false });

            function renderDiagram(code) {
                const diagramContainer = document.getElementById('diagramContainer');
                diagramContainer.innerHTML = `<div class="mermaid">${code}</div>`;
                mermaid.init(undefined, diagramContainer.querySelector('.mermaid'));

                const loadingSpinner = document.getElementById('loadingSpinner');
                loadingSpinner.classList.remove('show');

                diagramContainer.addEventListener('DOMSubtreeModified', () => {
                    const svgElement = diagramContainer.querySelector('svg');
                    if (svgElement) {
                        const panZoomInstance = svgPanZoom(svgElement, {
                            zoomEnabled: true,
                            controlIconsEnabled: false,
                            fit: true,
                            center: true
                        });

                        document.getElementById('zoomIn').addEventListener('click', () => panZoomInstance.zoomIn());
                        document.getElementById('zoomOut').addEventListener('click', () => panZoomInstance.zoomOut());
                        document.getElementById('resetZoom').addEventListener('click', () => panZoomInstance.resetZoom());
                        document.getElementById('fitToScreen').addEventListener('click', () => panZoomInstance.fit());

                        document.getElementById('exportSvg').addEventListener('click', () => exportDiagram('svg', svgElement));
                        document.getElementById('exportPng').addEventListener('click', () => exportDiagram('png', svgElement));
                        document.getElementById('exportPdf').addEventListener('click', () => exportDiagram('pdf', svgElement));
                    }
                });
            }

            function exportDiagram(type, svgElement) {
                const svgData = new XMLSerializer().serializeToString(svgElement);
                const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(svgBlob);

                if (type === 'svg') {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'diagram.svg';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } else if (type === 'png') {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    img.onload = () => {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        canvas.toBlob((blob) => {
                            const a = document.createElement('a');
                            a.href = URL.createObjectURL(blob);
                            a.download = 'diagram.png';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        }, 'image/png');
                    };
                    img.src = url;
                } else if (type === 'pdf') {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    pdf.addImage(url, 'SVG', 0, 0, 210, 297);
                    pdf.save('diagram.pdf');
                }

                URL.revokeObjectURL(url);
            }

            const initialCode = `
                graph TD
                A[Start] --> B{Is it?}
                B -- Yes --> C[OK]
                B -- No --> D[Not OK]
            `;
            renderDiagram(initialCode);

            document.getElementById('renderDiagram').addEventListener('click', () => {
                const mermaidCode = document.getElementById('mermaidCodeEditor').value;
                renderDiagram(mermaidCode);
            });

            document.getElementById('importMmd').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = e.target.result;
                        document.getElementById('mermaidCodeEditor').value = content;
                        renderDiagram(content);
                    };
                    reader.readAsText(file);
                }
            });

            const darkModeCheckbox = document.getElementById('darkModeCheckbox');
            darkModeCheckbox.addEventListener('change', () => {
                document.body.classList.toggle('dark-mode-body', darkModeCheckbox.checked);
            });

            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.32.1/min/vs' }});
            require(['vs/editor/editor.main'], function () {
                const editor = monaco.editor.create(document.getElementById('monacoEditorContainer'), {
                    value: initialCode,
                    language: 'plaintext',
                    theme: 'vs-dark',
                    automaticLayout: true
                });

                document.getElementById('renderDiagram').addEventListener('click', () => {
                    const code = editor.getValue();
                    document.getElementById('mermaidCodeEditor').value = code;
                    renderDiagram(code);
                });
            });
        });

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.querySelectorAll('.tabs .tab a');
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
    </script>
</body>
</html>
