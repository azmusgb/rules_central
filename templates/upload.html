{% extends "base.html" %} {% block title %}Upload | Rules Central{% endblock %}
{% block hero_title %}Upload Diagram{% endblock %} {% block hero_subtitle %}Drag
& drop your diagram files here, or click to select from your computer.{%
endblock %} {% block content %}
<div class="flex flex-col items-center justify-center animate-fadeIn delay-200">
  <form
    id="uploadForm"
    class="w-full max-w-xl bg-dark-800/80 rounded-3xl shadow-2xl border border-dark-700 p-10 u-glass flex flex-col items-center gap-8"
    hx-post="{{ url_for('upload.upload_file') }}"
    hx-target="#uploadSuccess"
    hx-swap="innerHTML"
    hx-indicator="#progressBar"
    hx-on="htmx:xhr:progress: window.dispatchEvent(new CustomEvent('upload-progress',{detail:event.detail}));"
    enctype="multipart/form-data"
    aria-label="Upload form"
  >
    <label
      for="fileInput"
      class="w-full flex flex-col items-center justify-center border-2 border-dashed border-primary-500 rounded-2xl p-10 cursor-pointer bg-gradient-to-br from-dark-900/80 to-dark-800/80 hover:from-primary-500/10 hover:to-accent-purple/10 transition-all duration-300 animate-fadeIn"
      tabindex="0"
      aria-label="Drag and drop files or click to select"
    >
      <svg
        class="w-16 h-16 mb-4 text-primary-500 animate-bounce"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          d="M12 4v16m8-8H4"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <span class="text-lg text-slate-200"
        >Drop files here or
        <span class="underline text-primary-400">click to browse</span></span
      >
      <input
        id="fileInput"
        name="file"
        type="file"
        class="hidden"
        required
        multiple
      />
    </label>
    <button
      type="submit"
      class="w-full px-8 py-4 rounded-xl bg-gradient-to-r from-primary-500 to-accent-purple text-white font-bold shadow-xl hover:scale-105 hover:shadow-2xl transition-all text-lg focus:outline-none focus:ring-4 focus:ring-primary-500"
    >
      Upload
    </button>
    <div
      id="progressBar"
      class="w-full h-3 rounded-full bg-dark-900 mt-4 overflow-hidden hidden"
    >
      <div
        class="h-full bg-gradient-to-r from-primary-500 to-accent-purple transition-all w-0"
      ></div>
    </div>
    <div id="uploadSuccess" class="hidden mt-6" aria-live="polite">
      {% include 'partials/confetti_success.html' %}
      <div class="text-lg text-green-400 font-bold text-center mt-4">
        Upload successful!
      </div>
    </div>
    <div
      id="uploadError"
      class="hidden mt-6 text-lg text-red-400 font-bold text-center"
      role="alert"
    >
      Upload failed. Please try again.
    </div>
  </form>
</div>
<script nonce="{{ csp_nonce }}">
  const progressBar = document.getElementById('progressBar');
  const progress = progressBar.querySelector('div');
  document.addEventListener('htmx:xhr:loadstart', () => {
    progressBar.classList.remove('hidden');
    progress.style.width = '0%';
  });
  document.addEventListener('upload-progress', e => {
    const percent = (e.detail.loaded / e.detail.total) * 100;
    progress.style.width = percent + '%';
  });
  document.addEventListener('htmx:xhr:loadend', () => {
    progressBar.classList.add('hidden');
  });
</script>
{% endblock %}
