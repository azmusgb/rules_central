<div class="container mx-auto px-4 py-8 relative z-10">
    <div class="glass-panel rounded-2xl p-8 shadow-lg animate-on-scroll" data-delay="500">
        <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-chart-bar text-primary-400"></i>
            Activity Stats
        </h3>
        <div id="activityStatsLoading" class="flex items-center gap-2 text-gray-400 mb-4">
            <div class="loading-spinner"></div>
            <span>Loading activity stats...</span>
        </div>
        <div id="activityStatsError" class="hidden text-red-400 mb-4">
            <i class="fas fa-exclamation-circle"></i>
            Failed to load activity stats.
            <button class="ml-2 px-3 py-1 rounded bg-primary-600 text-white text-xs hover:bg-primary-700 transition" id="retryActivityStats">
                Retry
            </button>
        </div>
        <ul id="activityStatsList" class="space-y-4">
            <!-- Populated by JS -->
        </ul>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const statsList = document.getElementById('activityStatsList');
    const loading = document.getElementById('activityStatsLoading');
    const error = document.getElementById('activityStatsError');
    const retryBtn = document.getElementById('retryActivityStats');

    async function loadActivityStats() {
        loading.classList.remove('hidden');
        error.classList.add('hidden');
        statsList.innerHTML = '';
        try {
            const res = await fetch('/api/diagram_catalogs');
            if (!res.ok) throw new Error('Failed to fetch');
            const data = await res.json();
            const entries = Object.entries(data);
            if (entries.length === 0) {
                statsList.innerHTML = '<li class="text-gray-400">No activity data available.</li>';
            } else {
                entries.forEach(([catalog, diagrams], idx) => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center justify-between bg-dark-800/80 rounded-lg px-6 py-4 shadow transition hover:bg-dark-700/90';
                    li.innerHTML = `
                        <span class="font-semibold text-primary-300 flex items-center gap-2">
                            <i class="fas fa-folder-open"></i>
                            ${catalog}
                        </span>
                        <span class="flex items-center gap-2">
                            <span class="text-lg font-bold text-white">${diagrams.length}</span>
                            <span class="text-gray-400 text-sm">diagrams</span>
                            <span class="inline-block w-32 h-2 bg-dark-700 rounded-full ml-4 overflow-hidden">
                                <span class="block h-full bg-primary-400 activity-bar" style="width: 0%"></span>
                            </span>
                        </span>
                    `;
                    statsList.appendChild(li);
                    // Animate bar
                    setTimeout(() => {
                        const bar = li.querySelector('.activity-bar');
                        const max = Math.max(...entries.map(e => e[1].length));
                        const percent = max ? Math.round((diagrams.length / max) * 100) : 0;
                        bar.style.width = percent + '%';
                        bar.style.transition = 'width 1.2s cubic-bezier(0.4,0,0.2,1)';
                    }, 100 + idx * 100);
                });
            }
            loading.classList.add('hidden');
        } catch (e) {
            loading.classList.add('hidden');
            error.classList.remove('hidden');
        }
    }
    if (retryBtn) retryBtn.addEventListener('click', loadActivityStats);
    loadActivityStats();
});
</script>
<style>
    .activity-bar {
        width: 0%;
        transition: width 1.2s cubic-bezier(0.4,0,0.2,1);
    }
    .loading-spinner {
        width: 1.5rem;
        height: 1.5rem;
        border: 3px solid rgba(255,255,255,0.1);
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>