{# ============================================================
   Rules Central • Global Navbar
   Sticky • Responsive • Theme-aware • Accessible
   ------------------------------------------------------------
   This partial is self‑styled so navigation always renders,
   even if the main CSS bundle fails to load.
   ------------------------------------------------------------ #}
<nav id="rc-nav"
     class="rc-nav fixed top-0 inset-x-0 z-50"
     role="navigation"
     aria-label="Main navigation">

  <div class="rc-nav-inner rc-container">
    {# Brand ------------------------------------------------- #}
    <a href="{{ url_for('main.index') }}" class="rc-brand" aria-label="Rules Central Home">
      <img src="{{ url_for('static', filename='images/RulesCentralLogo.png') }}"
           alt="Rules Central logo"
           width="120" height="24"
           class="rc-brand-logo" />
      <span class="rc-brand-name">Rules Central</span>
    </a>

    {# Desktop Nav ------------------------------------------ #}
    <ul class="rc-nav-links" data-rc-nav-desktop>
      <li>
        <a href="{{ url_for('main.index') }}"
           class="rc-nav-link {% if request.path == url_for('main.index') %}active{% endif %}"
           {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
          Dashboard
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.catalog') }}"
           class="rc-nav-link {% if request.path == url_for('main.catalog') %}active{% endif %}"
           {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
          Catalog
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.search') }}"
           class="rc-nav-link {% if request.path == url_for('main.search') %}active{% endif %}"
           {% if request.path == url_for('main.search') %}aria-current="page"{% endif %}>
          Search
        </a>
      </li>
      <li>
        <a href="{{ url_for('routes.full_help') }}"
           class="rc-nav-link {% if request.path == url_for('routes.full_help') %}active{% endif %}"
           {% if request.path == url_for('routes.full_help') %}aria-current="page"{% endif %}>
          Docs
        </a>
      </li>
      <li>
        <a href="{{ url_for('upload.upload_file') }}"
           class="rc-nav-link {% if request.path == url_for('upload.upload_file') %}active{% endif %}"
           {% if request.path == url_for('upload.upload_file') %}aria-current="page"{% endif %}>
          Upload
        </a>
      </li>
      <li>
        <a href="{{ url_for('diagrams.diagram_converter') }}"
           class="rc-nav-link {% if request.path == url_for('diagrams.diagram_converter') %}active{% endif %}"
           {% if request.path == url_for('diagrams.diagram_converter') %}aria-current="page"{% endif %}>
          Converter
        </a>
      </li>
      <li>
        <a href="{{ url_for('routes.faq_page') }}"
           class="rc-nav-link {% if request.path == url_for('routes.faq_page') %}active{% endif %}"
           {% if request.path == url_for('routes.faq_page') %}aria-current="page"{% endif %}>
          FAQ
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.about') }}"
           class="rc-nav-link {% if request.path == url_for('main.about') %}active{% endif %}"
           {% if request.path == url_for('main.about') %}aria-current="page"{% endif %}>
          About
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.contact') }}"
           class="rc-nav-link {% if request.path == url_for('main.contact') %}active{% endif %}"
           {% if request.path == url_for('main.contact') %}aria-current="page"{% endif %}>
          Contact
        </a>
      </li>
    </ul>

    {# Actions ---------------------------------------------- #}
    <div class="rc-nav-actions">
      {% if current_user.is_authenticated %}
        <div class="rc-user">
          <button class="rc-user-btn" type="button" aria-haspopup="menu" aria-expanded="false">
            <span class="rc-user-name">{{ current_user.username }}</span>
            <img src="{{ current_user.avatar_url or url_for('static', filename='images/default-avatar.png') }}"
                 alt="User avatar"
                 class="rc-user-avatar" width="32" height="32" />
            <svg viewBox="0 0 24 24" aria-hidden="true" class="rc-user-caret" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="rc-user-menu" role="menu" hidden>
            <a role="menuitem" href="{{ url_for('user_routes.profile') }}">Profile</a>
            <a role="menuitem" href="{{ url_for('auth.logout') }}" class="rc-user-signout">Sign Out</a>
          </div>
        </div>
      {% else %}
        <a href="{{ url_for('auth.login') }}" class="rc-nav-auth rc-nav-auth--login">Log In</a>
        <a href="{{ url_for('auth.register') }}" class="rc-nav-auth rc-nav-auth--signup">Sign Up</a>
      {% endif %}

      {# Theme toggle (inline SVG; no Font Awesome dep) #}
      <button id="theme-toggle"
              class="rc-theme-toggle"
              aria-label="Switch theme"
              aria-pressed="false"
              type="button">
        <svg class="rc-theme-ico" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <mask id="rc-theme-mask">
              <rect x="0" y="0" width="24" height="24" fill="#fff"/>
              <circle cx="24" cy="0" r="8" fill="#000"/>
            </mask>
          </defs>
          <circle cx="12" cy="12" r="8" class="rc-theme-sun" />
          <g class="rc-theme-rays" stroke-linecap="round">
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </g>
          <circle cx="12" cy="12" r="8" class="rc-theme-moon" mask="url(#rc-theme-mask)"/>
        </svg>
      </button>

      {# Mobile menu toggle #}
      <button id="rc-nav-mobile-toggle"
              class="rc-nav-mobile-toggle"
              aria-label="Open menu"
              aria-expanded="false"
              type="button">
        <span class="rc-nav-mobile-bars" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  {# Mobile Drawer ------------------------------------------ #}
  <div id="rc-nav-mobile-drawer" class="rc-nav-mobile-drawer" hidden>
    <div class="rc-nav-mobile-inner rc-container">
      <ul class="rc-nav-mobile-list" role="menu">
        <li>
          <a role="menuitem"
             href="{{ url_for('main.index') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.index') %}active{% endif %}"
             {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
            Dashboard
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.catalog') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.catalog') %}active{% endif %}"
             {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
            Catalog
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.search') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.search') %}active{% endif %}"
             {% if request.path == url_for('main.search') %}aria-current="page"{% endif %}>
            Search
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('routes.full_help') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('routes.full_help') %}active{% endif %}"
             {% if request.path == url_for('routes.full_help') %}aria-current="page"{% endif %}>
            Docs
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('upload.upload_file') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('upload.upload_file') %}active{% endif %}"
             {% if request.path == url_for('upload.upload_file') %}aria-current="page"{% endif %}>
            Upload
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('diagrams.diagram_converter') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('diagrams.diagram_converter') %}active{% endif %}"
             {% if request.path == url_for('diagrams.diagram_converter') %}aria-current="page"{% endif %}>
            Converter
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('routes.faq_page') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('routes.faq_page') %}active{% endif %}"
             {% if request.path == url_for('routes.faq_page') %}aria-current="page"{% endif %}>
            FAQ
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.about') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.about') %}active{% endif %}"
             {% if request.path == url_for('main.about') %}aria-current="page"{% endif %}>
            About
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.contact') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.contact') %}active{% endif %}"
             {% if request.path == url_for('main.contact') %}aria-current="page"{% endif %}>
            Contact
          </a>
        </li>

        {% if current_user.is_authenticated %}
          <li class="rc-nav-mobile-separator" role="presentation"></li>
          <li>
            <a role="menuitem" href="{{ url_for('user_routes.profile') }}" class="rc-nav-mobile-link">Profile</a>
          </li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.logout') }}" class="rc-nav-mobile-link rc-nav-mobile-signout">Sign Out</a>
          </li>
        {% else %}
          <li class="rc-nav-mobile-separator" role="presentation"></li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.login') }}" class="rc-nav-mobile-link">Log In</a>
          </li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.register') }}" class="rc-nav-mobile-link rc-nav-mobile-signup">Sign Up</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

{# ============================================================
   Navbar behavior script
   ------------------------------------------------------------ #}
<script>
(function(){
  const nav      = document.getElementById('rc-nav');
  const mobileT  = document.getElementById('rc-nav-mobile-toggle');
  const drawer   = document.getElementById('rc-nav-mobile-drawer');
  const userBtn  = nav.querySelector('.rc-user-btn');
  const userMenu = nav.querySelector('.rc-user-menu');
  const themeT   = document.getElementById('theme-toggle');

  /* Scroll shadow ----------------------------------------- */
  function onScroll(){
    if (window.scrollY > 8){
      nav.classList.add('rc-nav-scrolled');
    }else{
      nav.classList.remove('rc-nav-scrolled');
    }
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();

  /* Mobile drawer toggle ---------------------------------- */
  if (mobileT){
    mobileT.addEventListener('click', ()=>{
      const expanded = mobileT.getAttribute('aria-expanded') === 'true';
      mobileT.setAttribute('aria-expanded', String(!expanded));
      drawer.hidden = expanded;
    });
    /* Close when clicking a link */
    drawer.addEventListener('click', (e)=>{
      const link = e.target.closest('a');
      if (!link) return;
      drawer.hidden = true;
      mobileT.setAttribute('aria-expanded','false');
    });
  }

  /* User menu (desktop) ----------------------------------- */
  if (userBtn){
    userBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const expanded = userBtn.getAttribute('aria-expanded') === 'true';
      userBtn.setAttribute('aria-expanded', String(!expanded));
      userMenu.hidden = expanded;
    });
    document.addEventListener('click', (e)=>{
      if (!userMenu || userMenu.hidden) return;
      if (!nav.contains(e.target)){
        userMenu.hidden = true;
        userBtn.setAttribute('aria-expanded','false');
      }
    });
  }

  /* Theme toggle fallback --------------------------------- */
  if (themeT){
    themeT.addEventListener('click', ()=>{
      const root = document.documentElement;
      const isDark = root.classList.toggle('dark'); // toggle class
      themeT.setAttribute('aria-pressed', String(isDark));
      // If global RCTheme manager exists, sync
      if (window.RCTheme && typeof window.RCTheme.toggle === 'function'){
        window.RCTheme.toggle();
      }
      try{ localStorage.setItem('rc-theme', isDark ? 'dark' : 'light'); }catch(_){}
    });
    // init pressed state
    try{
      const pref = localStorage.getItem('rc-theme');
      if (pref){
        const root = document.documentElement;
        const wantDark = pref === 'dark';
        root.classList.toggle('dark', wantDark);
        themeT.setAttribute('aria-pressed', String(wantDark));
      }
    }catch(_){}
  }
})();
</script>