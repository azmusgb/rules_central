{% extends "base.html" %}
{% from 'macros/components.html' import input, button %}

{% block title %}Catalog Viewer | Rules Central{% endblock %}

{% block hero_title %}
  <h1 class="text-4xl md:text-5xl font-bold gradient-text">Catalog Viewer</h1>
{% endblock %}

{% block hero_subtitle %}
  <p class="mt-4 text-lg md:text-xl text-white/70 max-w-2xl mx-auto text-pretty">
    Browse diagrams with quick search and simple filters.
  </p>
{% endblock %}

{% block content %}
  <div class="px-6 py-12 space-y-12">
    <section class="mb-12">
      <!-- Search & Filters -->
      <div class="card--glass glassmorphism card-hover p-6 rounded-2xl">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-semibold text-white">Diagram Search & Filters</h2>
          <span class="text-sm text-white/60">Ctrl + K to focus search</span>
        </div>
        <div class="flex flex-col sm:flex-row gap-4">
          <div class="input focus-ring">
            {{ input('search', 'text', 'Search diagrams...') }}
          </div>
          <div x-data="{ filterOpen: false }" class="relative">
            {{ button('Filters', variant='secondary', type='button', classes='flex items-center gap-2') }}
            <span class="absolute -top-2 -right-2 bg-primary-600 text-white text-xs rounded-full px-2 py-1" x-show="filterOpen">0</span>
            <div 
              x-show="filterOpen" 
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              class="absolute z-10 mt-2 w-64 card--glass glassmorphism p-4 rounded-2xl"
              @click.outside="filterOpen = false"
            >
              <div class="space-y-4">
                <div>
                  <h3 class="text-sm font-semibold text-white">Diagram Types</h3>
                  <div class="mt-2 space-y-2">
                    {% for type in ['Flowchart', 'Sequence', 'Class', 'State'] %}
                      <label class="flex items-center gap-2 text-white/60">
                        <input type="checkbox" class="text-primary-600 focus-ring rounded" aria-label="{{ type }} filter">
                        <span>{{ type }}</span>
                      </label>
                    {% endfor %}
                  </div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-white">Other Filters</h3>
                  <div class="mt-2 space-y-2">
                    {% for filter in ['Favorites Only', 'Updated Last Week'] %}
                      <label class="flex items-center gap-2 text-white/60">
                        <input type="checkbox" class="text-primary-600 focus-ring rounded" aria-label="{{ filter }} filter">
                        <span>{{ filter }}</span>
                      </label>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{ button('Expand All', variant='secondary', type='button') }}
        </div>
      </div>
    </section>

    <section class="mb-12">
      <!-- Diagram Categories -->
      <div class="card--glass glassmorphism card-hover p-6 rounded-2xl">
        <h2 class="text-xl font-semibold text-white mb-6">Diagram Categories</h2>
        <div class="flex flex-wrap gap-2">
          {% for category in ['All', 'Business Rules', 'Decision Trees', 'Process Flows', 'State Machines', 'Validation Rules', 'Templates', 'Archived'] %}
            <button 
              class="btn btn-secondary text-sm" 
              :class="{ 'bg-white/20 text-blue-400': '{{ category }}' === 'All' }"
              aria-label="Filter by {{ category }}"
            >
              {{ category }}
              {% if category == 'Archived' %}(12){% endif %}
            </button>
          {% endfor %}
        </div>
      </div>
    </section>

    <section>
      <!-- All Visualizations -->
      <div class="card--glass glassmorphism card-hover p-6 rounded-2xl">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-semibold text-white">All Visualizations <span class="text-white/60">(24 results)</span></h2>
          <div class="flex items-center gap-4">
            <button 
              class="text-white/60 hover:text-blue-400 focus-ring float-animation" 
              aria-label="Grid view"
              x-data="{ gridView: true }" 
              x-on:click="gridView = true"
            >
              <i class="fas fa-th-large text-lg"></i>
            </button>
            <button 
              class="text-white/60 hover:text-blue-400 focus-ring float-animation" 
              aria-label="List view"
              x-on:click="gridView = false"
            >
              <i class="fas fa-list text-lg"></i>
            </button>
            <div x-data="{ sortOpen: false }" class="relative">
              {{ button('Sort: Newest', variant='secondary', type='button', classes='flex items-center gap-2') }}
              <div 
                x-show="sortOpen" 
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 scale-100"
                x-transition:leave-end="opacity-0 scale-95"
                class="absolute z-10 mt-2 w-48 card--glass glassmorphism p-2 rounded-2xl"
                @click.outside="sortOpen = false"
              >
                {% for sort in ['Newest', 'Oldest', 'A-Z', 'Z-A', 'Most Favorited', 'Most Viewed'] %}
                  <button class="dropdown-item w-full text-left">{{ sort }}</button>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

        <!-- Grid View -->
        <div x-show="gridView" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          {% for diagram in range(8) %}
            <div class="card--glass glassmorphism card-hover p-4 rounded-2xl">
              <div class="relative mb-4">
                <div class="skeleton w-full h-32 rounded-lg"></div>
                <button class="absolute top-2 right-2 text-white/60 hover:text-blue-400 focus-ring" aria-label="Favorite diagram">
                  <i class="fas fa-heart float-animation"></i>
                </button>
              </div>
              <div class="text-sm text-white/60">Flowchart</div>
              <h3 class="text-lg font-semibold text-white">Pricing Rules v{{ loop.index + 1 }}</h3>
              <p class="text-sm text-white/60 text-pretty">
                Business rules for product pricing based on customer segments and inventory levels
              </p>
              <div class="mt-2 text-sm text-white/60">
                {{ ['2 days', '1 week', '3 weeks', '1 month'][loop.index % 4] }} ago
              </div>
              <div class="mt-4">
                {{ button('Preview', variant='primary', type='button', classes='w-full') }}
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- List View -->
        <div x-show="!gridView" class="space-y-4 mb-8">
          {% for diagram in range(4) %}
            <div class="card--glass glassmorphism card-hover p-4 rounded-2xl flex flex-col sm:flex-row gap-4">
              <div class="relative w-full sm:w-48 h-32 flex-shrink-0">
                <div class="skeleton w-full h-full rounded-lg"></div>
                <button class="absolute top-2 right-2 text-white/60 hover:text-blue-400 focus-ring" aria-label="Favorite diagram">
                  <i class="fas fa-heart float-animation"></i>
                </button>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2">
                  <span class="text-sm text-white/60">Flowchart</span>
                  <span class="text-sm text-white/60">
                    {{ ['2 days', '1 week', '3 weeks', '1 month'][loop.index] }} ago
                  </span>
                </div>
                <h3 class="text-lg font-semibold text-white">Pricing Rules v{{ loop.index + 1 }}</h3>
                <p class="text-sm text-white/60 text-pretty">
                  Business rules for product pricing based on customer segments and inventory levels. This includes seasonal pricing adjustments and volume discount calculations.
                </p>
                <div class="mt-2 flex flex-wrap gap-2">
                  {% for tag in ['pricing', 'discounts', 'segmentation'] %}
                    <span class="px-2 py-1 text-xs bg-white/10 text-white/60 rounded">{{ tag }}</span>
                  {% endfor %}
                  {% if loop.index == 3 %}
                    <span class="px-2 py-1 text-xs bg-white/10 text-white/60 rounded">seasonal</span>
                  {% endif %}
                </div>
                <div class="mt-2 text-sm text-white/60">
                  by {{ ['Sarah Johnson', 'Michael Chen', 'Emma Wilson', 'David Kim'][loop.index] }}
                </div>
                <div class="mt-4 flex gap-2">
                  {{ button('Preview', variant='primary', type='button') }}
                  {{ button('Download', variant='secondary', type='button') }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- No Results -->
        <div class="card--glass glassmorphism p-6 rounded-2xl text-center hidden" role="alert">
          <h3 class="text-lg font-semibold text-white">No diagrams found</h3>
          <p class="text-sm text-white/60 mt-2 text-pretty">
            Try adjusting your search or filter criteria to find what you're looking for.
          </p>
          {{ button('Reset Search & Filters', variant='primary', type='button', classes='mt-4') }}
        </div>

        <!-- Pagination -->
        <div class="flex items-center justify-between mt-6">
          <p class="text-sm text-white/60">Showing 1 to 8 of 24 results</p>
          <div class="flex gap-2">
            {{ button('Previous', variant='secondary', type='button') }}
            {% for page in [1, 2, 3] %}
              <button 
                class="btn btn-primary text-sm" 
                :class="{ 'bg-white/20': {{ page == 1 }} }" 
                aria-label="Page {{ page }}"
              >
                {{ page }}
              </button>
            {% endfor %}
            {{ button('Next', variant='secondary', type='button') }}
          </div>
        </div>
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script defer src="{{ url_for('static', filename='js/catalog_shortcuts.js') }}"></script>
{% endblock %}