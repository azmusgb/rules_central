<nav class="fixed top-0 w-full h-16 bg-white/90 backdrop-blur-md border-b border-stroke-color z-50 transition-all duration-300" role="navigation" aria-label="Main navigation">
    <div class="wrapper flex items-center justify-between h-full">
        <!-- Logo/Brand -->
        <a href="{{ url_for('main.index') }}" class="flex items-center gap-2 group" aria-label="Rules Central Home">
            <img src="{{ url_for('static', filename='images/RulesCentralLogo.png') }}" 
                 class="h-6 w-auto transition-transform group-hover:scale-105" 
                 alt="Rules Central logo"
                 width="120"
                 height="24">
            <span class="font-bold text-text-color group-hover:text-accent-color transition-colors duration-200">Rules Central</span>
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center h-full">
            <ul class="flex items-center h-full gap-1">
                <li class="h-full flex items-center">
                    <a class="nav-link px-4 h-full flex items-center"
                       href="{{ url_for('main.index') }}"
                       {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
                        Dashboard
                    </a>
                </li>
                <li class="h-full flex items-center">
                    <a class="nav-link px-4 h-full flex items-center"
                       href="{{ url_for('main.catalog') }}"
                       {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
                        Catalog
                    </a>
                </li>
                <li class="h-full flex items-center">
                    <a class="nav-link px-4 h-full flex items-center"
                       href="{{ url_for('diagrams.diagrams_index') }}"
                       {% if request.path == url_for('diagrams.diagrams_index') %}aria-current="page"{% endif %}>
                        Diagrams
                    </a>
                </li>
                <li class="h-full flex items-center">
                    <a class="nav-link px-4 h-full flex items-center"
                       href="{{ url_for('routes.activity') }}"
                       {% if request.path == url_for('routes.activity') %}aria-current="page"{% endif %}>
                        Activity
                    </a>
                </li>
            </ul>
        </div>

        <!-- Right-side Actions -->
        <div class="flex items-center gap-4">
            {% if current_user.is_authenticated %}
                <!-- User dropdown -->
                <div class="relative group h-full flex items-center">
                    <button class="flex items-center gap-2 p-1 rounded-full hover:bg-background-secondary-color transition-colors duration-200 h-full">
                        <span class="text-sm font-medium text-text-color">{{ current_user.username }}</span>
                        <img src="{{ current_user.avatar_url or url_for('static', filename='images/default-avatar.png') }}" 
                             class="h-8 w-8 rounded-full border border-stroke-color transition-transform group-hover:scale-105" 
                             alt="User avatar">
                    </button>
                </div>
            {% else %}
                <!-- Auth links -->
                <a href="{{ url_for('auth.login') }}" class="px-4 py-2 rounded-full font-medium h-10 flex items-center border border-stroke-color hover:bg-background-secondary-color transition-colors duration-200">
                    Log In
                </a>
                <a href="{{ url_for('auth.register') }}" class="link-button">
                    Sign Up
                </a>
            {% endif %}

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-toggle" 
                    class="md:hidden p-2 rounded-full hover:bg-background-secondary-color focus:outline-none transition-colors duration-200 h-10 w-10 flex items-center justify-center"
                    aria-label="Open menu"
                    aria-expanded="false"
                    type="button">
                <svg class="w-6 h-6 text-text-color" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="md:hidden hidden absolute top-16 left-0 right-0 bg-background-color shadow-lg border-t border-stroke-color transition-all duration-300 backdrop-blur-md">
        <div class="wrapper py-2">
            <ul class="flex flex-col gap-1">
                <li>
                    <a class="nav-link block px-4 py-3 rounded-lg"
                       href="{{ url_for('main.index') }}"
                       {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a class="nav-link block px-4 py-3 rounded-lg"
                       href="{{ url_for('main.catalog') }}"
                       {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
                        Catalog
                    </a>
                </li>
                <li>
                    <a class="nav-link block px-4 py-3 rounded-lg"
                       href="{{ url_for('diagrams.diagrams_index') }}"
                       {% if request.path == url_for('diagrams.diagrams_index') %}aria-current="page"{% endif %}>
                        Diagrams
                    </a>
                </li>
                <li>
                    <a class="nav-link block px-4 py-3 rounded-lg"
                       href="{{ url_for('routes.activity') }}"
                       {% if request.path == url_for('routes.activity') %}aria-current="page"{% endif %}>
                        Activity
                    </a>
                </li>
                
                {% if current_user.is_authenticated %}
                    <li class="mt-2 pt-2 border-t border-stroke-color">
                        <a class="block px-4 py-3 rounded-lg font-medium text-text-color hover:bg-background-secondary-color transition-colors duration-200" 
                           href="{{ url_for('user_routes.profile') }}">
                            Profile
                        </a>
                    </li>
                    <li>
                        <a class="block px-4 py-3 rounded-lg font-medium text-accent-color hover:bg-background-secondary-color transition-colors duration-200" 
                           href="{{ url_for('auth.logout') }}">
                            Sign Out
                        </a>
                    </li>
                {% else %}
                    <li class="mt-2 pt-2 border-t border-stroke-color">
                        <a class="block px-4 py-3 rounded-lg font-medium text-text-color hover:bg-background-secondary-color transition-colors duration-200"
                           href="{{ url_for('auth.login') }}">
                            Log In
                        </a>
                    </li>
                    <li>
                        <a class="link-button w-full text-center block px-4 py-3 rounded-lg font-medium"
                           href="{{ url_for('auth.register') }}">
                            Sign Up
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        
        mobileMenuToggle.addEventListener('click', () => {
            const isExpanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
            mobileMenuToggle.setAttribute('aria-expanded', !isExpanded);
            mobileMenu.classList.toggle('hidden');
            
            // Toggle icon between hamburger and X
            const icon = mobileMenuToggle.querySelector('svg');
            if (!isExpanded) {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
            }
        });

        // Close mobile menu when clicking on a link
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
                mobileMenuToggle.setAttribute('aria-expanded', 'false');
                mobileMenuToggle.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
            });
        });
    });
</script>