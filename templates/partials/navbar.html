{# ============================================================
   Rules Central • Global Navbar
   Sticky • Responsive • Theme-aware • Accessible
   ------------------------------------------------------------
   This partial is self‑styled so navigation always renders,
   even if the main CSS bundle fails to load.
   ------------------------------------------------------------ #}
<nav id="rc-nav"
     class="rc-nav fixed top-0 inset-x-0 z-50"
     role="navigation"
     aria-label="Main navigation">

  <div class="rc-nav-inner rc-container">
    {# Brand ------------------------------------------------- #}
    <a href="{{ url_for('main.index') }}" class="rc-brand" aria-label="Rules Central Home">
      <img src="{{ url_for('static', filename='images/RulesCentralLogo.png') }}"
           alt="Rules Central logo"
           width="120" height="24"
           class="rc-brand-logo" />
      <span class="rc-brand-name">Rules Central</span>
    </a>

    {# Desktop Nav ------------------------------------------ #}
    <ul class="rc-nav-links" data-rc-nav-desktop>
      <li>
        <a href="{{ url_for('main.index') }}"
           class="rc-nav-link {% if request.path == url_for('main.index') %}active{% endif %}"
           {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
          Dashboard
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.catalog') }}"
           class="rc-nav-link {% if request.path == url_for('main.catalog') %}active{% endif %}"
           {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
          Catalog
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.search') }}"
           class="rc-nav-link {% if request.path == url_for('main.search') %}active{% endif %}"
           {% if request.path == url_for('main.search') %}aria-current="page"{% endif %}>
          Search
        </a>
      </li>
      <li>
        <a href="{{ url_for('routes.full_help') }}"
           class="rc-nav-link {% if request.path == url_for('routes.full_help') %}active{% endif %}"
           {% if request.path == url_for('routes.full_help') %}aria-current="page"{% endif %}>
          Docs
        </a>
      </li>
      <li>
        <a href="{{ url_for('upload.upload_file') }}"
           class="rc-nav-link {% if request.path == url_for('upload.upload_file') %}active{% endif %}"
           {% if request.path == url_for('upload.upload_file') %}aria-current="page"{% endif %}>
          Upload
        </a>
      </li>
      <li>
        <a href="{{ url_for('diagrams.diagram_converter') }}"
           class="rc-nav-link {% if request.path == url_for('diagrams.diagram_converter') %}active{% endif %}"
           {% if request.path == url_for('diagrams.diagram_converter') %}aria-current="page"{% endif %}>
          Converter
        </a>
      </li>
      <li>
        <a href="{{ url_for('routes.faq_page') }}"
           class="rc-nav-link {% if request.path == url_for('routes.faq_page') %}active{% endif %}"
           {% if request.path == url_for('routes.faq_page') %}aria-current="page"{% endif %}>
          FAQ
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.about') }}"
           class="rc-nav-link {% if request.path == url_for('main.about') %}active{% endif %}"
           {% if request.path == url_for('main.about') %}aria-current="page"{% endif %}>
          About
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.contact') }}"
           class="rc-nav-link {% if request.path == url_for('main.contact') %}active{% endif %}"
           {% if request.path == url_for('main.contact') %}aria-current="page"{% endif %}>
          Contact
        </a>
      </li>
    </ul>

    {# Actions ---------------------------------------------- #}
    <div class="rc-nav-actions">
      {% if current_user.is_authenticated %}
        <div class="rc-user">
          <button class="rc-user-btn" type="button" aria-haspopup="menu" aria-expanded="false">
            <span class="rc-user-name">{{ current_user.username }}</span>
            <img src="{{ current_user.avatar_url or url_for('static', filename='images/default-avatar.png') }}"
                 alt="User avatar"
                 class="rc-user-avatar" width="32" height="32" />
            <svg viewBox="0 0 24 24" aria-hidden="true" class="rc-user-caret" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="rc-user-menu" role="menu" hidden>
            <a role="menuitem" href="{{ url_for('user_routes.profile') }}">Profile</a>
            <a role="menuitem" href="{{ url_for('auth.logout') }}" class="rc-user-signout">Sign Out</a>
          </div>
        </div>
      {% else %}
        <a href="{{ url_for('auth.login') }}" class="rc-nav-auth rc-nav-auth--login">Log In</a>
        <a href="{{ url_for('auth.register') }}" class="rc-nav-auth rc-nav-auth--signup">Sign Up</a>
      {% endif %}

      {# Theme toggle (inline SVG; no Font Awesome dep) #}
      <button id="theme-toggle"
              class="rc-theme-toggle"
              aria-label="Switch theme"
              aria-pressed="false"
              type="button">
        <svg class="rc-theme-ico" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <mask id="rc-theme-mask">
              <rect x="0" y="0" width="24" height="24" fill="#fff"/>
              <circle cx="24" cy="0" r="8" fill="#000"/>
            </mask>
          </defs>
          <circle cx="12" cy="12" r="8" class="rc-theme-sun" />
          <g class="rc-theme-rays" stroke-linecap="round">
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </g>
          <circle cx="12" cy="12" r="8" class="rc-theme-moon" mask="url(#rc-theme-mask)"/>
        </svg>
      </button>

      {# Mobile menu toggle #}
      <button id="rc-nav-mobile-toggle"
              class="rc-nav-mobile-toggle"
              aria-label="Open menu"
              aria-expanded="false"
              type="button">
        <span class="rc-nav-mobile-bars" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  {# Mobile Drawer ------------------------------------------ #}
  <div id="rc-nav-mobile-drawer" class="rc-nav-mobile-drawer" hidden>
    <div class="rc-nav-mobile-inner rc-container">
      <ul class="rc-nav-mobile-list" role="menu">
        <li>
          <a role="menuitem"
             href="{{ url_for('main.index') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.index') %}active{% endif %}"
             {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
            Dashboard
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.catalog') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.catalog') %}active{% endif %}"
             {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
            Catalog
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.search') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.search') %}active{% endif %}"
             {% if request.path == url_for('main.search') %}aria-current="page"{% endif %}>
            Search
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('routes.full_help') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('routes.full_help') %}active{% endif %}"
             {% if request.path == url_for('routes.full_help') %}aria-current="page"{% endif %}>
            Docs
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('upload.upload_file') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('upload.upload_file') %}active{% endif %}"
             {% if request.path == url_for('upload.upload_file') %}aria-current="page"{% endif %}>
            Upload
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('diagrams.diagram_converter') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('diagrams.diagram_converter') %}active{% endif %}"
             {% if request.path == url_for('diagrams.diagram_converter') %}aria-current="page"{% endif %}>
            Converter
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('routes.faq_page') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('routes.faq_page') %}active{% endif %}"
             {% if request.path == url_for('routes.faq_page') %}aria-current="page"{% endif %}>
            FAQ
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.about') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.about') %}active{% endif %}"
             {% if request.path == url_for('main.about') %}aria-current="page"{% endif %}>
            About
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.contact') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.contact') %}active{% endif %}"
             {% if request.path == url_for('main.contact') %}aria-current="page"{% endif %}>
            Contact
          </a>
        </li>

        {% if current_user.is_authenticated %}
          <li class="rc-nav-mobile-separator" role="presentation"></li>
          <li>
            <a role="menuitem" href="{{ url_for('user_routes.profile') }}" class="rc-nav-mobile-link">Profile</a>
          </li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.logout') }}" class="rc-nav-mobile-link rc-nav-mobile-signout">Sign Out</a>
          </li>
        {% else %}
          <li class="rc-nav-mobile-separator" role="presentation"></li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.login') }}" class="rc-nav-mobile-link">Log In</a>
          </li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.register') }}" class="rc-nav-mobile-link rc-nav-mobile-signup">Sign Up</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

{# ============================================================
   Inline styles: nav‑only so it renders even if main CSS fails.
   Tokens cascade from :root in base.html.
   ============================================================ #}
<style>
:root{
  --rc-nav-h:3.5rem;
  --rc-nav-bg:rgba(255,255,255,.75);
  --rc-nav-bg-blur:blur(12px);
  --rc-nav-border:rgba(0,0,0,.08);
  --rc-nav-accent:#f43f5e;
}
html.dark{
  --rc-nav-bg:rgba(15,23,42,.75);
  --rc-nav-border:rgba(255,255,255,.15);
}
.rc-container{max-width:min(90rem,100%);margin-inline:auto;padding-inline:clamp(1rem,3vw,2rem)}
.rc-nav{
  height:var(--rc-nav-h);
  backdrop-filter:var(--rc-nav-bg-blur);
  background:var(--rc-nav-bg);
  border-bottom:1px solid var(--rc-nav-border);
  transition:box-shadow .15s ease,background .15s ease;
}
.rc-nav-scrolled{box-shadow:0 2px 8px rgba(0,0,0,.15)}
.rc-nav-inner{display:flex;align-items:center;justify-content:space-between;height:100%;gap:1rem}
.rc-brand{display:inline-flex;align-items:center;gap:.5rem;text-decoration:none}
.rc-brand-logo{height:1.5rem;width:auto;transition:transform .15s ease}
.rc-brand:hover .rc-brand-logo{transform:scale(1.05)}
.rc-brand-name{font-weight:700;font-size:1rem;color:inherit;white-space:nowrap}

.rc-nav-links{display:none;align-items:center;gap:.25rem;height:100%;margin:0;padding:0;list-style:none}
@media (min-width:768px){.rc-nav-links{display:flex}}
.rc-nav-link{
  display:inline-flex;align-items:center;justify-content:center;height:calc(var(--rc-nav-h) - 2px);
  padding-inline:1rem;
  border-radius:.75rem;
  font-size:.9375rem;
  font-weight:600;
  text-decoration:none;
  color:inherit;
  transition:background .12s ease,color .12s ease;
}
.rc-nav-link:hover{background:rgba(0,0,0,.05)}
html.dark .rc-nav-link:hover{background:rgba(255,255,255,.1)}
.rc-nav-link.active{color:#fff;background:var(--rc-nav-accent)}
html.dark .rc-nav-link.active{color:#fff}

.rc-nav-actions{display:flex;align-items:center;gap:.75rem}
.rc-nav-auth{font-weight:600;font-size:.9375rem;text-decoration:none;padding:.375rem 1rem;border-radius:9999px;line-height:1;border:1px solid var(--rc-nav-border)}
.rc-nav-auth--login:hover{background:rgba(0,0,0,.05)}html.dark .rc-nav-auth--login:hover{background:rgba(255,255,255,.1)}
.rc-nav-auth--signup{background:var(--rc-nav-accent);border-color:var(--rc-nav-accent);color:#fff}
.rc-nav-auth--signup:hover{filter:brightness(1.05)}

.rc-user{position:relative;display:none;align-items:center}
@media (min-width:768px){.rc-user{display:flex}}
.rc-user-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.25rem .5rem;border-radius:9999px;border:1px solid transparent;background:transparent;cursor:pointer;font-size:.9375rem}
.rc-user-btn:hover{background:rgba(0,0,0,.05)}html.dark .rc-user-btn:hover{background:rgba(255,255,255,.1)}
.rc-user-avatar{border-radius:9999px;display:block}
.rc-user-menu{position:absolute;top:calc(100% + .25rem);right:0;min-width:10rem;padding:.5rem;border-radius:.5rem;border:1px solid var(--rc-nav-border);background:var(--rc-nav-bg);backdrop-filter:var(--rc-nav-bg-blur);display:grid;gap:.25rem}
.rc-user-menu a{padding:.5rem .75rem;border-radius:.375rem;text-decoration:none;font-size:.875rem;font-weight:600;color:inherit}
.rc-user-menu a:hover{background:rgba(0,0,0,.05)}html.dark .rc-user-menu a:hover{background:rgba(255,255,255,.1)}
.rc-user-signout{color:var(--rc-nav-accent)}

.rc-theme-toggle{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:9999px;border:1px solid var(--rc-nav-border);background:transparent;cursor:pointer;transition:background .12s ease}
.rc-theme-toggle:hover{background:rgba(0,0,0,.05)}html.dark .rc-theme-toggle:hover{background:rgba(255,255,255,.1)}
.rc-theme-ico{width:1.25rem;height:1.25rem;stroke:currentColor;fill:none}
.rc-theme-ico .rc-theme-sun{fill:currentColor;opacity:.85}
.rc-theme-ico .rc-theme-moon{fill:currentColor;opacity:0}
html.dark .rc-theme-ico .rc-theme-sun{opacity:0}
html.dark .rc-theme-ico .rc-theme-moon{opacity:.85}
.rc-theme-ico .rc-theme-rays{stroke:currentColor;opacity:.75}
html.dark .rc-theme-ico .rc-theme-rays{opacity:0}

.rc-nav-mobile-toggle{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:9999px;border:1px solid var(--rc-nav-border);background:transparent;cursor:pointer}
@media (min-width:768px){.rc-nav-mobile-toggle{display:none}}
.rc-nav-mobile-bars,
.rc-nav-mobile-bars::before,
.rc-nav-mobile-bars::after{
  content:"";
  display:block;
  width:1rem;
  height:2px;
  background:currentColor;
  border-radius:1px;
  position:relative;
  transition:transform .15s ease,opacity .15s ease;
}
.rc-nav-mobile-bars::before{position:absolute;top:-4px}
.rc-nav-mobile-bars::after{position:absolute;top:4px}
.rc-nav-mobile-toggle[aria-expanded="true"] .rc-nav-mobile-bars{background:transparent}
.rc-nav-mobile-toggle[aria-expanded="true"] .rc-nav-mobile-bars::before{transform:translateY(4px) rotate(45deg)}
.rc-nav-mobile-toggle[aria-expanded="true"] .rc-nav-mobile-bars::after{transform:translateY(-4px) rotate(-45deg)}

.rc-nav-mobile-drawer{position:absolute;top:100%;left:0;right:0;z-index:49;background:var(--rc-nav-bg);backdrop-filter:var(--rc-nav-bg-blur);border-bottom:1px solid var(--rc-nav-border)}
.rc-nav-mobile-inner{padding-block:.75rem}
.rc-nav-mobile-list{display:grid;gap:.25rem;margin:0;padding:0;list-style:none}
.rc-nav-mobile-link{display:block;padding:.75rem 1rem;border-radius:.5rem;text-decoration:none;font-weight:600}
.rc-nav-mobile-link:hover{background:rgba(0,0,0,.05)}html.dark .rc-nav-mobile-link:hover{background:rgba(255,255,255,.1)}
.rc-nav-mobile-link.active{background:var(--rc-nav-accent);color:#fff}
.rc-nav-mobile-separator{height:1px;margin:.5rem 0;background:var(--rc-nav-border);list-style:none}
.rc-nav-mobile-signout{color:var(--rc-nav-accent)}
.rc-nav-mobile-signup{background:var(--rc-nav-accent);color:#fff;text-align:center}

</style>

{# ============================================================
   Navbar behavior script
   ------------------------------------------------------------ #}
<script>
(function(){
  const nav      = document.getElementById('rc-nav');
  const mobileT  = document.getElementById('rc-nav-mobile-toggle');
  const drawer   = document.getElementById('rc-nav-mobile-drawer');
  const userBtn  = nav.querySelector('.rc-user-btn');
  const userMenu = nav.querySelector('.rc-user-menu');
  const themeT   = document.getElementById('theme-toggle');

  /* Scroll shadow ----------------------------------------- */
  function onScroll(){
    if (window.scrollY > 8){
      nav.classList.add('rc-nav-scrolled');
    }else{
      nav.classList.remove('rc-nav-scrolled');
    }
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();

  /* Mobile drawer toggle ---------------------------------- */
  if (mobileT){
    mobileT.addEventListener('click', ()=>{
      const expanded = mobileT.getAttribute('aria-expanded') === 'true';
      mobileT.setAttribute('aria-expanded', String(!expanded));
      drawer.hidden = expanded;
    });
    /* Close when clicking a link */
    drawer.addEventListener('click', (e)=>{
      const link = e.target.closest('a');
      if (!link) return;
      drawer.hidden = true;
      mobileT.setAttribute('aria-expanded','false');
    });
  }

  /* User menu (desktop) ----------------------------------- */
  if (userBtn){
    userBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const expanded = userBtn.getAttribute('aria-expanded') === 'true';
      userBtn.setAttribute('aria-expanded', String(!expanded));
      userMenu.hidden = expanded;
    });
    document.addEventListener('click', (e)=>{
      if (!userMenu || userMenu.hidden) return;
      if (!nav.contains(e.target)){
        userMenu.hidden = true;
        userBtn.setAttribute('aria-expanded','false');
      }
    });
  }

  /* Theme toggle fallback --------------------------------- */
  if (themeT){
    themeT.addEventListener('click', ()=>{
      const root = document.documentElement;
      const isDark = root.classList.toggle('dark'); // toggle class
      themeT.setAttribute('aria-pressed', String(isDark));
      // If global RCTheme manager exists, sync
      if (window.RCTheme && typeof window.RCTheme.toggle === 'function'){
        window.RCTheme.toggle();
      }
      try{ localStorage.setItem('rc-theme', isDark ? 'dark' : 'light'); }catch(_){}
    });
    // init pressed state
    try{
      const pref = localStorage.getItem('rc-theme');
      if (pref){
        const root = document.documentElement;
        const wantDark = pref === 'dark';
        root.classList.toggle('dark', wantDark);
        themeT.setAttribute('aria-pressed', String(wantDark));
      }
    }catch(_){}
  }
})();
</script>