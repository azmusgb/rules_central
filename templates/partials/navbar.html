{# ============================================================
   Rules Central Global Navbar
   Responsive | Sticky | Theme-aware | Accessible
   ============================================================ #}
<nav id="rc-nav"
     class="rc-nav fixed top-0 inset-x-0 z-50"
     role="navigation"
     aria-label="Main navigation">

  <div class="rc-nav-inner rc-container">
    <!-- Brand ------------------------------------------------>
    <a href="{{ url_for('main.index') }}" class="rc-brand" aria-label="Rules Central Home">
      <img src="{{ url_for('static', filename='images/RulesCentralLogo.png') }}"
           alt="Rules Central logo"
           width="120" height="24"
           class="rc-brand-logo" />
      <span class="rc-brand-name">Rules Central</span>
    </a>

    <!-- Desktop Nav ----------------------------------------->
    <ul class="rc-nav-links" data-rc-nav-desktop>
      <li>
        <a href="{{ url_for('main.index') }}"
           class="rc-nav-link {% if request.path == url_for('main.index') %}active{% endif %}"
           {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
          Dashboard
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.catalog') }}"
           class="rc-nav-link {% if request.path == url_for('main.catalog') %}active{% endif %}"
           {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
          Catalog
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.search') }}"
           class="rc-nav-link {% if request.path == url_for('main.search') %}active{% endif %}"
           {% if request.path == url_for('main.search') %}aria-current="page"{% endif %}>
          Search
        </a>
      </li>
      <li>
        <a href="{{ url_for('routes.full_help') }}"
           class="rc-nav-link {% if request.path == url_for('routes.full_help') %}active{% endif %}"
           {% if request.path == url_for('routes.full_help') %}aria-current="page"{% endif %}>
          Docs
        </a>
      </li>
      <li>
        <a href="{{ url_for('upload.upload_file') }}"
           class="rc-nav-link {% if request.path == url_for('upload.upload_file') %}active{% endif %}"
           {% if request.path == url_for('upload.upload_file') %}aria-current="page"{% endif %}>
          Upload
        </a>
      </li>
      <li>
        <a href="{{ url_for('diagrams.diagram_converter') }}"
           class="rc-nav-link {% if request.path == url_for('diagrams.diagram_converter') %}active{% endif %}"
           {% if request.path == url_for('diagrams.diagram_converter') %}aria-current="page"{% endif %}>
          Converter
        </a>
      </li>
      <li>
        <a href="{{ url_for('collab.faq_page') }}"
           class="rc-nav-link {% if request.path == url_for('collab.faq_page') %}active{% endif %}"
           {% if request.path == url_for('collab.faq_page') %}aria-current="page"{% endif %}>
          FAQ
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.about') }}"
           class="rc-nav-link {% if request.path == url_for('main.about') %}active{% endif %}"
           {% if request.path == url_for('main.about') %}aria-current="page"{% endif %}>
          About
        </a>
      </li>
      <li>
        <a href="{{ url_for('main.contact') }}"
           class="rc-nav-link {% if request.path == url_for('main.contact') %}active{% endif %}"
           {% if request.path == url_for('main.contact') %}aria-current="page"{% endif %}>
          Contact
        </a>
      </li>
    </ul>

    <!-- Actions --------------------------------------------->
    <div class="rc-nav-actions">
      {% if current_user.is_authenticated %}
        <div class="rc-user">
          <button class="rc-user-btn" type="button" aria-haspopup="menu" aria-expanded="false">
            <span class="rc-user-name">{{ current_user.username }}</span>
            <img src="{{ current_user.avatar_url or url_for('static', filename='images/default-avatar.png') }}"
                 alt="User avatar"
                 class="rc-user-avatar" width="32" height="32" />
            <svg viewBox="0 0 24 24" aria-hidden="true" class="rc-user-caret" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="rc-user-menu" role="menu" hidden>
            <a role="menuitem" href="{{ url_for('user_routes.profile') }}">Profile</a>
            <a role="menuitem" href="{{ url_for('auth.logout') }}" class="rc-user-signout">Sign Out</a>
          </div>
        </div>
      {% else %}
        <a href="{{ url_for('auth.login') }}" class="rc-nav-auth rc-nav-auth--login">Log In</a>
        <a href="{{ url_for('auth.register') }}" class="rc-nav-auth rc-nav-auth--signup">Sign Up</a>
      {% endif %}

      <!-- Theme toggle -->
      <button id="theme-toggle" class="rc-theme-toggle" aria-label="Switch theme" type="button">
        <i class="fas fa-adjust" aria-hidden="true"></i>
      </button>

      <!-- Mobile menu toggle -->
      <button id="rc-nav-mobile-toggle"
              class="rc-nav-mobile-toggle"
              aria-label="Open menu"
              aria-expanded="false"
              type="button">
        <span class="rc-nav-mobile-bars" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Drawer ----------------------------------------->
  <div id="rc-nav-mobile-drawer" class="rc-nav-mobile-drawer" hidden>
    <div class="rc-nav-mobile-inner rc-container">
      <ul class="rc-nav-mobile-list" role="menu">
        <li>
          <a role="menuitem"
             href="{{ url_for('main.index') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.index') %}active{% endif %}"
             {% if request.path == url_for('main.index') %}aria-current="page"{% endif %}>
            Dashboard
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.catalog') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.catalog') %}active{% endif %}"
             {% if request.path == url_for('main.catalog') %}aria-current="page"{% endif %}>
            Catalog
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('diagrams.diagrams_index') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('diagrams.diagrams_index') %}active{% endif %}"
             {% if request.path == url_for('diagrams.diagrams_index') %}aria-current="page"{% endif %}>
            Diagrams
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('routes.activity') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('routes.activity') %}active{% endif %}"
             {% if request.path == url_for('routes.activity') %}aria-current="page"{% endif %}>
            Activity
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.search') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.search') %}active{% endif %}"
             {% if request.path == url_for('main.search') %}aria-current="page"{% endif %}>
            Search
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('routes.full_help') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('routes.full_help') %}active{% endif %}"
             {% if request.path == url_for('routes.full_help') %}aria-current="page"{% endif %}>
            Docs
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('upload.upload_file') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('upload.upload_file') %}active{% endif %}"
             {% if request.path == url_for('upload.upload_file') %}aria-current="page"{% endif %}>
            Upload
          </a>
        </li>
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('diagrams.diagram_converter') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('diagrams.diagram_converter') %}active{% endif %}"
             {% if request.path == url_for('diagrams.diagram_converter') %}aria-current="page"{% endif %}>
            Converter
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('collab.faq_page') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('collab.faq_page') %}active{% endif %}"
             {% if request.path == url_for('collab.faq_page') %}aria-current="page"{% endif %}>
            FAQ
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.about') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.about') %}active{% endif %}"
             {% if request.path == url_for('main.about') %}aria-current="page"{% endif %}>
            About
          </a>
        </li>
        <li>
          <a role="menuitem"
             href="{{ url_for('main.contact') }}"
             class="rc-nav-mobile-link {% if request.path == url_for('main.contact') %}active{% endif %}"
             {% if request.path == url_for('main.contact') %}aria-current="page"{% endif %}>
            Contact
          </a>
        </li>

        {% if current_user.is_authenticated %}
          <li class="rc-nav-mobile-separator" role="presentation"></li>
          <li>
            <a role="menuitem" href="{{ url_for('user_routes.profile') }}" class="rc-nav-mobile-link">Profile</a>
          </li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.logout') }}" class="rc-nav-mobile-link rc-nav-mobile-signout">Sign Out</a>
          </li>
        {% else %}
          <li class="rc-nav-mobile-separator" role="presentation"></li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.login') }}" class="rc-nav-mobile-link">Log In</a>
          </li>
          <li>
            <a role="menuitem" href="{{ url_for('auth.register') }}" class="rc-nav-mobile-link rc-nav-mobile-signup">Sign Up</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

{# ============================================================
   Inline styles: nav-only so it renders even if main CSS fails.
   (Tokens cascade from :root in base.html)
   ============================================================ #}

{# ============================================================
   Navbar behavior script
   - Scroll shadow
   - Mobile drawer toggle
   - User menu toggle
   ============================================================ #}
<script>
(function(){
  const root    = document.documentElement;
  const nav     = document.getElementById('rc-nav');
  const mobileT = document.getElementById('rc-nav-mobile-toggle');
  const drawer  = document.getElementById('rc-nav-mobile-drawer');
  const userBtn = nav.querySelector('.rc-user-btn');
  const userMenu= nav.querySelector('.rc-user-menu');

  // Scroll state (shadow only after scroll)
  function onScroll(){
    if (window.scrollY > 8){
      nav.classList.add('rc-nav-scrolled');
    } else {
      nav.classList.remove('rc-nav-scrolled');
    }
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();

  // Mobile menu toggle
  if (mobileT){
    mobileT.addEventListener('click', () => {
      const expanded = mobileT.getAttribute('aria-expanded') === 'true';
      mobileT.setAttribute('aria-expanded', String(!expanded));
      if (expanded){
        drawer.hidden = true;
      } else {
        drawer.hidden = false;
      }
    });
    // Close drawer when any link inside is clicked
    drawer.addEventListener('click', (e)=>{
      const link = e.target.closest('a');
      if (!link) return;
      drawer.hidden = true;
      mobileT.setAttribute('aria-expanded','false');
    });
  }

  // User menu (desktop)
  if (userBtn){
    userBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const expanded = userBtn.getAttribute('aria-expanded') === 'true';
      userBtn.setAttribute('aria-expanded', String(!expanded));
      userMenu.hidden = expanded;
    });
    document.addEventListener('click', (e)=>{
      if (!userMenu || userMenu.hidden) return;
      if (!nav.contains(e.target)){
        userMenu.hidden = true;
        userBtn.setAttribute('aria-expanded','false');
      }
    });
  }
})();
</script>